



CREATE TABLE Genres
(
  GenreID NUMBER(2) PRIMARY KEY,
  GenreName VARCHAR2(20) NOT NULL UNIQUE
);

INSERT INTO Genres VALUES(3, 'Devotional');
INSERT INTO Genres VALUES(4, 'Romcom');
INSERT INTO Genres VALUES(5, 'SciFi');
INSERT INTO Genres VALUES(6, 'Comedy');
INSERT INTO Genres VALUES(7, 'Horror');
INSERT INTO Genres VALUES(8, 'Thriller');
INSERT INTO Genres VALUES(9, 'Romantic');
INSERT INTO Genres VALUES(10, 'Drama');
INSERT INTO Genres VALUES(11, 'Fantasy');
INSERT INTO Genres VALUES(12, 'Action');
INSERT INTO Genres VALUES(13, 'Crimethriller');
INSERT INTO Genres VALUES(14, 'Technothriller');


Select * from Genres;

CREATE TABLE Stores
(
  StoreID NUMBER(3) PRIMARY KEY,
  Location VARCHAR2(30)
);

INSERT INTO Stores VALUES(1, 'Chicago East');
INSERT INTO Stores VALUES(2, 'Chicago West');
INSERT INTO Stores VALUES(3, 'Chicago Central');
INSERT INTO Stores VALUES(4, 'Chicago Nort');
INSERT INTO Stores VALUES(5, 'Chicago South');


SELECT Location FROM (select STORES.LOCATION as Location, COUNT(*) FROM STORES LEFT JOIN CUSTOMERS ON STORES.STOREID = CUSTOMERS.HOMESTORE GROUP BY STORES.LOCATION ORDER BY COUNT(*) DESC) WHERE ROWNUM =1;

CREATE TABLE Customers
(
  CardNo NUMBER(6) PRIMARY KEY,
  FName VARCHAR2 (30),
  LName VARCHAR2 (30),
  Genre1 VARCHAR2(20),
  Genre2 VARCHAR2(20),
  HomeStore NUMBER(3),
  CONSTRAINT genre1_fk FOREIGN KEY (Genre1)
    REFERENCES Genres (GenreName),
  CONSTRAINT genre2_fk FOREIGN KEY (Genre2)
    REFERENCES Genres (GenreName), 
  CONSTRAINT storehomeid_fk FOREIGN KEY (HomeStore)
    REFERENCES Stores(StoreID), 
  CONSTRAINT card_check CHECK (LENGTH(CardNo) = 6)
);



INSERT INTO Customers VALUES(237186, 'Dave', 'Davies', 'Animation', 'SciFi', 1);
INSERT INTO Customers VALUES(731678, 'Linda', 'Davies', 'Biography', 'Devotional', 2);
INSERT INTO Customers VALUES(879032, 'Sarvesh', 'Kaushik', 'Romantic', 'Comedy', 3);
INSERT INTO Customers VALUES(267812, 'James', 'Papademas', 'Comedy', 'Romcom', 4);
INSERT INTO Customers VALUES(267813, 'Michael', 'Baah', 'Horror', 'Romantic', 5);
INSERT INTO Customers VALUES(986431, 'Steve', 'Smith', 'Drama', 'Comedy', 3);
INSERT INTO Customers VALUES(926431, 'Steve', 'Smith', 'Horror', 'Comedy', 2);
INSERT INTO Customers VALUES(928432, 'Cary', 'Mohan', 'Comedy', 'Technothriller', 4);
INSERT INTO Customers VALUES(928422, 'William', 'George', 'Romantic', 'Devotional', 4);
INSERT INTO Customers VALUES(928444, 'Sam', 'Cowderly', 'Biography', 'Comedy', 4);
INSERT INTO Customers VALUES(928455, 'Andy', 'Jessy', 'Horror', 'Devotional', 4);













CREATE TABLE Products(
ProdID VARCHAR2(15) PRIMARY KEY,
ProdCost NUMBER(7,2),
ProdName VARCHAR2(30),
ProdType VARCHAR2(1) CHECK (ProdType IN ('M', 'I')),
ProdInv NUMBER(4)
);

INSERT INTO PRODUCTS VALUES (101, 8.99, 'Star Wars: Force Awakens', 'M', 9);
INSERT INTO PRODUCTS VALUES (102, 20.99, 'Gone with the Wind', 'M', 3);
INSERT INTO PRODUCTS VALUES (103, 20.22, 'Acrimony', 'M', 4);
INSERT INTO PRODUCTS VALUES (104, 20.21, 'HateIQ', 'M', 5);
INSERT INTO PRODUCTS VALUES (105, 20.23, 'Godfather', 'I', 6);
INSERT INTO PRODUCTS VALUES (106, 20.12, 'Acrimony', 'I', 7);
INSERT INTO PRODUCTS VALUES (107, 238.00, 'Spiderman', 'I', 4);
INSERT INTO PRODUCTS VALUES (108, 20.12, 'Godfather1', 'I', 7);
INSERT INTO PRODUCTS VALUES (109, 20.12, 'Godfather2', 'I', 7);
INSERT INTO PRODUCTS VALUES (110, 20.12, 'Godfather3', 'I', 7);
INSERT INTO PRODUCTS VALUES (111, 20.12, 'Godfather4', 'I', 7);
INSERT INTO PRODUCTS VALUES (112, 20.12, 'Godfather5', 'I', 7);
INSERT INTO PRODUCTS VALUES (113, 20.12, 'Godfather6', 'I', 7);


select * from Customers;


CREATE TABLE Movies 
(
  ProdID VARCHAR2(15) PRIMARY KEY,
  MovieYear NUMBER(4),
  MovieGenreID NUMBER(2),
  CONSTRAINT genre_fk FOREIGN KEY (MovieGenreID)
    REFERENCES Genres (GenreID),
  CONSTRAINT ProdID FOREIGN KEY (ProdID)
    REFERENCES PRODUCTS (ProdID)  
); 

INSERT INTO MOVIES VALUES (101, 2015, 1);
INSERT INTO MOVIES VALUES (102, 1977, 2);
INSERT INTO MOVIES VALUES (103, 1972, 4);
INSERT INTO MOVIES VALUES (104, 1979, 5);
INSERT INTO MOVIES VALUES (105, 1980, 3);
 


Select * from Items;

CREATE TABLE Items
(
  ProdID VARCHAR2(15) PRIMARY KEY,
  ItemName  VARCHAR2(25),
  ItemPartNo VARCHAR2(20),
  CONSTRAINT prod_id_fk FOREIGN KEY (ProdID)
    REFERENCES Products (ProdID)
);
INSERT INTO Items VALUES ('104', 'Beats by Dr. Dre', 'XY345');
INSERT INTO ITEMS VALUES ('102', 'RockStar Games', 'RD-45-2017');
INSERT INTO ITEMS VALUES ('106', 'Acrimony', 'RD-46-2018');
INSERT INTO ITEMS VALUES ('103', 'RockStar Games', 'RD-45-2017');
INSERT INTO ITEMS VALUES ('105', 'Ubisoft', 'RD-84-2019');

CREATE TABLE AV_Orders
(
  Order_ID NUMBER(4) PRIMARY KEY,
  CardNo NUMBER(6),
  PMT_Method VARCHAR2(10) CONSTRAINT pmt_check 
  CHECK (PMT_Method IN ('CASH', 'CHECK', 'CREDIT')),
  Order_Date DATE,
  CONSTRAINT card#_fk FOREIGN KEY (CardNo)
    REFERENCES Customers (CardNo)
);

INSERT INTO AV_ORDERS VALUES (1001, 731678, 'CREDIT','10-MAR-2023');
INSERT INTO AV_ORDERS VALUES (1002, 267812, 'CASH','10-JAN-2025');
INSERT INTO AV_ORDERS VALUES (1003, 267813, 'CHECK','22-APR-2025');
INSERT INTO AV_ORDERS VALUES (1004, 879032, 'CHECK','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1006, 267813, 'CHECK','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1005, 267813, 'CHECK','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1007, 267813, 'CHECK','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1008, 879032, 'CHECK','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1009, 267813, 'CHECK','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1010, 267813, 'CHECK','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1011, 267813, 'CHECK','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1012, 267813, 'CHECK','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1013, 731678, 'CHECK','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1014, 267813, 'CREDIT','28-AUG-2022');
INSERT INTO AV_ORDERS VALUES (1015, 731678, 'CREDIT','28-AUG-2022');











CREATE TABLE Order_Invoice
(
  Order_ID NUMBER(4),
  LineNo NUMBER(2),
  ProdID VARCHAR2(15),  
  QTY NUMBER(3), 
  CONSTRAINT order_line_invoice_pk PRIMARY KEY(Order_ID, LineNo),
  CONSTRAINT order_id_invoice_fk FOREIGN KEY (Order_ID)
    REFERENCES AV_ORDERS (Order_ID),
  CONSTRAINT prod_id_invoice_fk FOREIGN KEY (ProdID)
    REFERENCES PRODUCTS (ProdID)
);




INSERT INTO ORDER_INVOICE VALUES (1001,1,'104', 1);
INSERT INTO ORDER_INVOICE VALUES (1002,2,'101', 2);
INSERT INTO ORDER_INVOICE VALUES (1003,3,'106', 1);
INSERT INTO ORDER_INVOICE VALUES (1004,4,'105', 2);
INSERT INTO ORDER_INVOICE VALUES (1005,5,'105', 1);
INSERT INTO ORDER_INVOICE VALUES (1006,6,'102', 4);
INSERT INTO ORDER_INVOICE VALUES (1007,7,'103', 4);
INSERT INTO ORDER_INVOICE VALUES (1008,8,'110', 4);
INSERT INTO ORDER_INVOICE VALUES (1009,9,'110', 4);
INSERT INTO ORDER_INVOICE VALUES (1010,10,'105', 4);
INSERT INTO ORDER_INVOICE VALUES (1011,11,'105', 4);
INSERT INTO ORDER_INVOICE VALUES (1012,12,'105', 4);
INSERT INTO ORDER_INVOICE VALUES (1013,13,'102', 4);
INSERT INTO ORDER_INVOICE VALUES (1014,14,'102', 4);
INSERT INTO ORDER_INVOICE VALUES (1015,15,'102', 4);









SELECT  ROWNUM, genrename
FROM 
(
      SELECT  g.genrename
      FROM order_invoice oi INNER JOIN Movies m
      ON oi.prodid = m.prodid
      JOIN genres g
      ON m.moviegenreid = g.genreid
      
      ORDER BY g.genrename 
)
WHERE ROWNUM <= 10;


 SELECT g.genrename as GenreName, count(*)
      FROM order_invoice oi INNER JOIN Movies m
      ON oi.prodid = m.prodid
      JOIN genres g
      ON m.moviegenreid = g.genreid
      group by (g.genrename)
      ORDER BY COUNT(*) DESC;
      

INSERT INTO MOVIES VALUES (107, 2018, 5);
INSERT INTO MOVIES VALUES (108, 2018, 4);
INSERT INTO MOVIES VALUES (109, 2018, 2);
INSERT INTO MOVIES VALUES (110, 2018, 4);
INSERT INTO MOVIES VALUES (111, 2018, 5);
INSERT INTO MOVIES VALUES (112, 2019, 5);
INSERT INTO MOVIES VALUES (113, 2020, 2);



INSERT INTO ORDER_INVOICE VALUES (1016,16,'117', 2);
INSERT INTO ORDER_INVOICE VALUES (1017,17,'113', 2);
INSERT INTO ORDER_INVOICE VALUES (1018,18,'112', 2);
INSERT INTO ORDER_INVOICE VALUES (1019,19,'117', 2);
INSERT INTO ORDER_INVOICE VALUES (1020,20,'118', 2);

INSERT INTO ORDER_INVOICE VALUES (1021,21,'112', 2);

INSERT INTO ORDER_INVOICE VALUES (1022,22,'120', 2);
INSERT INTO ORDER_INVOICE VALUES (1023,23,'121', 2);
INSERT INTO ORDER_INVOICE VALUES (1024,24,'122', 2);
INSERT INTO ORDER_INVOICE VALUES (1025,25,'123', 2);


INSERT INTO AV_ORDERS VALUES (1016, 267813, 'CREDIT','10-MAR-2023');

INSERT INTO AV_ORDERS VALUES (1017, 267813, 'CREDIT','10-JAN-2020');
INSERT INTO AV_ORDERS VALUES (1018, 928432, 'CREDIT','10-FEB-2020');

INSERT INTO AV_ORDERS VALUES (1019, 731678, 'CHECK','10-MAR-2023');
INSERT INTO AV_ORDERS VALUES (1020, 731678, 'CHECK','10-MAR-2024');
INSERT INTO AV_ORDERS VALUES (1021, 731678, 'CHECK','10-MAR-2024');
INSERT INTO AV_ORDERS VALUES (1022, 731678, 'CHECK','10-MAR-2024');
INSERT INTO AV_ORDERS VALUES (1023, 731678, 'CHECK','10-MAR-2024');
INSERT INTO AV_ORDERS VALUES (1024, 731678, 'CREDIT','10-MAR-2024');
INSERT INTO AV_ORDERS VALUES (1025, 731678, 'CREDIT','10-MAR-2024');





INSERT INTO PRODUCTS VALUES (114, 8.99, 'Shrek', 'M', 5);
INSERT INTO PRODUCTS VALUES (115, 8.99, 'Shrek1', 'M', 5);
INSERT INTO PRODUCTS VALUES (116, 8.99, 'Shrek2', 'M', 5);
INSERT INTO PRODUCTS VALUES (117, 8.99, 'Shrek4', 'M', 5);
INSERT INTO PRODUCTS VALUES (118, 8.99, 'Shrek5', 'M', 5);
INSERT INTO PRODUCTS VALUES (119, 8.99, 'Shrek6', 'M', 5);
INSERT INTO PRODUCTS VALUES (120, 8.99, 'Shrek7', 'M', 5);
INSERT INTO PRODUCTS VALUES (121, 9.99, 'Shrek8', 'M', 5);
INSERT INTO PRODUCTS VALUES (122, 10.99, 'Shrek9', 'M', 5);
INSERT INTO PRODUCTS VALUES (123, 8.99, 'Shrek10', 'M', 5);



INSERT INTO MOVIES VALUES (111, 2020, 3);

INSERT INTO MOVIES VALUES (112, 2020, 3);

INSERT INTO MOVIES VALUES (113, 2020, 8);

INSERT INTO MOVIES VALUES (114, 2020, 2);

INSERT INTO MOVIES VALUES (115, 2020, 9);

INSERT INTO MOVIES VALUES (116, 2020, 3);

INSERT INTO MOVIES VALUES (117, 2020, 8);

INSERT INTO MOVIES VALUES (118, 2020, 8);
INSERT INTO MOVIES VALUES (119, 2020, 10);
INSERT INTO MOVIES VALUES (120, 2020, 11);
INSERT INTO MOVIES VALUES (121, 2021, 13);
INSERT INTO MOVIES VALUES (122, 2022, 14);
INSERT INTO MOVIES VALUES (123, 2023, 12);






Select GenreName from (SELECT g.genrename as GenreName, count(*)
      FROM order_invoice oi INNER JOIN Movies m
      ON oi.prodid = m.prodid
      JOIN genres g
      ON m.moviegenreid = g.genreid
      group by (g.genrename)
      ORDER BY COUNT (*) DESC) where ROWNUM<=10;




Select CardNumber, CountTimes from (SELECT Customers.CARDNO as CardNumber,Count(*) as CountTimes FROM Customers 
LEFT JOIN AV_Orders ON Customers.CARDNO = AV_Orders.CARDNO Group By (Customers.CARDNO) 
Order By Count(*) desc)where ROWNUM<=10




SELECT CUSTOMERS.FNAME,CUSTOMERS.LNAME FROM CUSTOMERS WHERE CARDNO IN(267813,731678,928422,928422,928432,928444,928455,986431,267812,237186,926431);



SELECT Location FROM (select STORES.LOCATION as Location, COUNT(*) FROM STORES LEFT JOIN CUSTOMERS ON STORES.STOREID = CUSTOMERS.HOMESTORE GROUP BY STORES.LOCATION ORDER BY COUNT(*) DESC) WHERE ROWNUM =1;



select Pref_Method from (SELECT AV_ORDERS.PMT_METHOD as Pref_Method, COUNT(*) FROM AV_ORDERS GROUP BY AV_ORDERS.PMT_METHOD ORDER BY COUNT(*) DESC) WHERE ROWNUM=1;



SELECT AVG(QTY)AS AverageRentals FROM ORDER_INVOICE;
























































